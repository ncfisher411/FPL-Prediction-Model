"0","set.seed(123)"
"0",""
"0","train_index <- sample(1:nrow(mid), nrow(mid) * 0.8)"
"0","train_data <- mid[train_index, ]"
"0","x_train <- train_data %>% select(-c(""Player""))"
"0","  "
"0","y_train <- train_data %>% select(Points) %>% data.matrix()"
"0","test_data <- mid[-train_index, ]"
"0","x_test <- test_data %>% select(-c(""Player"")) %>% data.matrix()"
"0","y_test <- test_data %>% select(Points) %>% data.matrix()"
"0","#dim(train_data)"
"0","#dim(test_data)"
"0",""
"0","#tr_control <- trainControl(method = ""repeatedcv"", number = 10, repeats=3, search = ""grid"")"
"0","#model <- train(Points~., data = x_train, method = ""rf"", trControl = tr_control, ntree=100)"
"0","#print(model)"
"0","#best mtry=35"
"0","tr_control <- trainControl(method = ""repeatedcv"", number = 10, repeats=3, search = ""random"")"
"0","#model <- train(Points~., data = x_train, method = ""rf"", trControl = tr_control, ntree=100)"
"0","#print(model)"
"0","# Best is random, mtry=14"
"0","tunegrid <- expand.grid(.mtry=14)"
"0",""
"0","#one <- list()"
"0","#for (maxnodes in c(15:25)){"
"0","#  set.seed(123)"
"0","#  rf_maxnode <- train(Points~., data=x_train, method=""rf"", tuneGrid=tunegrid,"
"0","#                      trControl=tr_control, importance=T, nodesize=14,"
"0","#                      maxnodes=maxnodes, ntree=100)"
"0","#  current_iteration <- toString(maxnodes)"
"0","#  one[[current_iteration]] <- rf_maxnode"
"0","#}"
"0","#two <- resamples(one)"
"0","#summary(two)"
"0","# best maxnodes is 20"
"0",""
"0","#three <- list()"
"0","#for(ntree in c(50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700)) {"
"0","#  set.seed(123)"
"0","#  rf_maxtrees <- train(Points~., data=x_train, method=""rf"", tuneGrid=tunegrid,"
"0","#                       trControl=tr_control, importance=T, nodesize=14,"
"0","#                       maxnodes=20, ntree=ntree)"
"0","#  key <- toString(ntree)"
"0","#  three[[key]] <- rf_maxtrees"
"0","#}"
"0","#four <- resamples(three)"
"0","#summary(four)"
"0","# best trees is 150"
"0","rf_model <- train(Points~., data = x_train, method = ""rf"", tuneGrid=tunegrid,"
"0","              trControl=tr_control, importance=T, nodesize=14, ntree=150,"
"0","              maxnodes=20)"
"0",""
"0","prediction <- predict(rf_model, x_test)"
"0","mse <- mean((y_test-prediction)^2)"
"0","rmse <- sqrt(mse)"
"0","rsq <- 1-(sum((y_test-prediction)^2) / sum((y_test-mean(y_test))^2))"
"0",""
"0","x_test <- outfield %>% filter(Season==2023) %>% "
"0","  filter(Position==""MID"") %>% select(all_of(m_rows)) %>%"
"0","  mutate_all(~ ifelse(is.na(.),0,.)) %>%"
"0","  data.matrix()"
"0","temp <- outfield %>% filter(Season==2023) %>%"
"0","  filter(Position==""MID"") %>% select(Player, Points)"
"0","prediction <- predict(rf_model, x_test) %>% data.frame() %>% "
"0","  rename(Predicted=1) %>% cbind(temp) %>% "
"0","  mutate(Validation=Predicted-Points)"
"0","avg_error <- mean(prediction$Validation)"
"0","min_error <- min(prediction$Validation)"
"0","max_error <- max(prediction$Validation)"
"0",""
"0","temp <- data.frame(MSE=mse, RMSE=rmse, `R^2`=rsq, Avg_error=avg_error,"
"0","                            Max_error=max_error, Min_error=min_error) %>%"
"0","  mutate(Position=""MID"") %>% mutate(Model=""Random Forest"") %>%"
"0","  select(Model, Position, everything())"
"0","model_summary <- model_summary %>% rbind(temp)"
