"0","set.seed(123)"
"0",""
"0","train_index <- sample(1:nrow(mid), nrow(mid) * 0.8)"
"0","train_data <- mid[train_index, ]"
"0","x_train <- train_data %>% select(-c(""Player""))"
"0","  "
"0","y_train <- train_data %>% select(Points) %>% data.matrix()"
"0","test_data <- mid[-train_index, ]"
"0","x_test <- test_data %>% select(-c(""Player"")) %>% data.frame()"
"0","y_test <- test_data %>% select(Points) %>% data.matrix()"
"0","#dim(train_data)"
"0","#dim(test_data)"
"0",""
"0","#tunegrid <- expand.grid(learning_rate=c(0.3, 0.1, 0.05, 0.01, 0.005),"
"0","#                        RMSE=NA, trees=NA, time=NA)"
"0",""
"0","#for(i in seq_len(nrow(tunegrid))) {"
"0","#  set.seed(123)"
"0","#  one <- system.time({"
"0","#    m <- gbm(Points~., data=x_train, distribution=""gaussian"", n.trees=5000,"
"0","#             shrinkage = tunegrid$learning_rate[i],"
"0","#             interaction.depth=3, n.minobsinnode=10, cv.folds=10)"
"0","#  })"
"0","#  tunegrid$RMSE[i] <- sqrt(min(m$cv.error))"
"0","#  tunegrid$trees[i] <- which.min(m$cv.error)"
"0","#  tunegrid$Time[i] <- one[[""elapsed""]]"
"0","#}"
"0","# 541 trees is optimal"
"0",""
"0","gbm_model <- gbm(Points~., data = x_train, distribution = ""gaussian"","
"0","            n.trees=541, shrinkage=0.05, interaction.depth = 3,"
"0","            n.minobsinnode = 10, cv.folds = 10)"
"0",""
"0","prediction <- predict(gbm_model, x_test)"
"2","Using 534 trees...

"
"0","mse <- mean((y_test-prediction)^2)"
"0","rmse <- sqrt(mse)"
"0","rsq <- 1-(sum((y_test-prediction)^2) / sum((y_test-mean(y_test))^2))"
"0",""
"0","x_test <- outfield %>% filter(Season==2023) %>% "
"0","  filter(Position==""MID"") %>% select(all_of(m_rows)) %>%"
"0","  mutate_all(~ ifelse(is.na(.),0,.)) %>%"
"0","  data.frame()"
"0","temp <- outfield %>% filter(Season==2023) %>%"
"0","  filter(Position==""MID"") %>% select(Player, Points)"
"0","prediction <- predict(gbm_model, x_test) %>% data.frame() %>% "
"0","  rename(Predicted=1) %>% cbind(temp) %>% "
"0","  mutate(Validation=Predicted-Points)"
"2","Using 534 trees...

"
"0","avg_error <- mean(prediction$Validation)"
"0","min_error <- min(prediction$Validation)"
"0","max_error <- max(prediction$Validation)"
"0",""
"0","temp <- data.frame(MSE=mse, RMSE=rmse, `R^2`=rsq, Avg_error=avg_error,"
"0","                            Max_error=max_error, Min_error=min_error) %>%"
"0","  mutate(Position=""MID"") %>% mutate(Model=""Gradient Boosting"") %>%"
"0","  select(Model, Position, everything())"
"0","model_summary <- model_summary %>% rbind(temp)"
